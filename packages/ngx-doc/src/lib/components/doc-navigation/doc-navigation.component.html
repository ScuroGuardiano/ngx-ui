<ngx-nav-menu [expanded]="navigationExpanded">
  <div
    class="ngx-doc-navigation__logo"
    *ngIf="logo"
    [attr.data-collapsed]="!navigationExpanded"
    [attr.data-logo-collapsed]="hasLogoCollapsed"
  >
    <ng-content select="ngxDocNavigationLogo"></ng-content>
    <ngx-icon
      [svgSrc]="navigationExpanded ? 'slide-left' : 'slide-right'"
      class="ngx-doc-navigation__expander"
      (click)="navigationExpandedChange.emit(!navigationExpanded)"
    ></ngx-icon>
  </div>
  <div
    class="ngx-doc-navigation__search"
    [attr.data-no-logo]="!logo"
    *ngIf="search && navigationExpanded"
  >
    <ngx-input
      ngxAppearance
      ngxSize
      ngxAutofocus
      ngxInputAttribute
      ngxMarginless
      type="text"
      placeholder="Search..."
      [formControl]="queryControl"
    >
      <ngx-input-prefix>
        <ngx-icon fontIcon="search"></ngx-icon>
      </ngx-input-prefix>
      <ngx-input-suffix>
        <button
          class="btn btn-link"
          [hidden]="!queryControl.value.length"
          (click)="queryControl.setValue('')"
        >
          <ngx-icon class="search-box__clear-btn" fontIcon="x"></ngx-icon>
        </button>
      </ngx-input-suffix>
    </ngx-input>
  </div>
  <ul class="ngx-doc-navigation__nav nav-items vertical-list ngx-scroll-muted">
    <li
      *ngFor="
        let menuItem of filteredNavigationItems$ | async;
        trackBy: trackByItemName
      "
      class="nav-item-container"
    >
      <a
        *ngIf="!menuItem.children"
        class="nav-item"
        ngxTooltip
        tooltipPlacement="right"
        [tooltipTitle]="menuItem.name"
        routerLink="{{ menuItem.route }}"
        routerLinkActive="active"
      >
        <ngx-icon *ngIf="menuItem.icon" [fontIcon]="menuItem.icon"></ngx-icon>
        <span class="nav-label">{{ menuItem.name }}</span>
      </a>

      <div
        *ngIf="menuItem.children"
        class="nav-item"
        ngxTooltip
        [tooltipContext]="menuItem.children"
        [tooltipCssClass]="'nav-popover'"
        tooltipType="popover"
        tooltipPlacement="right"
        [tooltipTemplate]="!navigationExpanded ? childrenTemplate : undefined"
        [tooltipShowCaret]="false"
        tooltipAlignment="top"
        [tooltipSpacing]="1"
        [tooltipDisabled]="!menuItem.expanded"
        (click)="menuItem.expanded = !menuItem.expanded"
      >
        <ngx-icon *ngIf="menuItem.icon" [fontIcon]="menuItem.icon"></ngx-icon>
        <span class="nav-label">{{ menuItem.name }}</span>
      </div>

      <ng-template #childrenTemplate>
        <div class="title">{{ menuItem.name }}</div>
        <ul *ngIf="menuItem.children" class="sub-nav ngx-scroll-muted">
          <a
            *ngFor="let child of menuItem.children"
            class="sub-nav-item"
            [routerLink]="child.route"
            routerLinkActive="active"
          >
            <span class="subnav-label">{{ child.name }}</span>
            <ngx-icon fontIcon="check" class="active-indicator"></ngx-icon>
          </a>
        </ul>
      </ng-template>

      <ul
        *ngIf="menuItem.children && navigationExpanded"
        class="sub-nav ngx-scroll-muted"
      >
        <a
          *ngFor="let child of menuItem.children"
          class="sub-nav-item"
          routerLink="{{ child.route }}"
          routerLinkActive="active"
        >
          <span class="subnav-label">{{ child.name }}</span>
          <ngx-icon fontIcon="check" class="active-indicator"></ngx-icon>
        </a>
      </ul>
    </li>
  </ul>
</ngx-nav-menu>
